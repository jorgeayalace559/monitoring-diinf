- name: Instalar dependencias
  apt:
    name:
      - wget
      - gdebi-core
    state: present
    update_cache: yes

- name: Copiar Checkmk .deb desde el rol
  copy:
    src: check-mk-raw-2.3.0p34_0.jammy_amd64.deb
    dest: /tmp/checkmk.deb


- name: Instalar Checkmk desde .deb
  apt:
    deb: /tmp/checkmk.deb

- name: Crear sitio "monitoring"
  command: omd create monitoring
  args:
    creates: /opt/omd/sites/monitoring
  register: omd_create_output

- name: Mostrar salida de creaci√≥n del sitio
  debug:
    var: omd_create_output.stdout_lines

- name: Iniciar sitio Checkmk
  command: omd start monitoring
  register: omd_start_output

- name: Mostrar salida de inicio del sitio
  debug:
    var: omd_start_output.stdout_lines


- name: Mostrar URL de acceso
  debug:
    msg: "Checkmk disponible en http://{{ inventory_hostname }}/monitoring"
